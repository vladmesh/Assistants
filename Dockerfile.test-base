# Base image for unit tests
# Contains pytest tooling and shared_models pre-installed
# Build: docker build -f Dockerfile.test-base -t assistants-test-base .
# Rebuild when: shared_models changes, pytest versions update

FROM python:3.11-slim

# Install test tooling (pinned versions for reproducibility)
RUN pip install --no-cache-dir \
    pytest==8.0.0 \
    pytest-asyncio==0.23.5 \
    pytest-cov==4.1.0 \
    pytest-mock==3.12.0 \
    pytest-env==1.1.3

# Install poetry for dependency resolution
RUN pip install --no-cache-dir poetry==1.8.3

# Copy and install shared_models with its dependencies (common for all services)
COPY shared_models /shared_models
WORKDIR /shared_models
RUN poetry config virtualenvs.create false && \
    poetry install --only main --no-interaction --no-ansi

ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    TESTING=1

WORKDIR /svc
