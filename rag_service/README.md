# RAG Service

Сервис для Retrieval-Augmented Generation (RAG), предоставляющий функциональность для хранения и поиска векторных эмбеддингов текстовых данных.

## Возможности

- Хранение векторных эмбеддингов текстовых данных
- Поиск по векторным эмбеддингам с использованием ChromaDB
- Поддержка различных типов данных (общие правила, пользовательская история, заметки ассистентов)
- Фильтрация по типу данных, пользователю и ассистенту
- REST API для добавления и поиска данных

## Требования

- Python 3.11+
- Poetry для управления зависимостями
- Docker и Docker Compose (опционально)

## Установка

### Локальная установка

1. Клонируйте репозиторий:
   ```bash
   git clone <repository-url>
   cd rag_service
   ```

2. Установите зависимости с помощью Poetry:
   ```bash
   poetry install
   ```

3. Создайте файл `.env` на основе примера:
   ```bash
   cp .env.example .env
   ```

4. Запустите сервис:
   ```bash
   poetry run python -m src.main
   ```

### Установка с использованием Docker

1. Соберите образ:
   ```bash
   docker build -t rag-service .
   ```

2. Запустите контейнер:
   ```bash
   docker run -p 8002:8002 rag-service
   ```

## Использование

### API Эндпоинты

#### Добавление данных

```
POST /api/data/add
```

Добавляет новые данные в векторную базу данных.

**Тело запроса:**
```json
{
  "text": "Текстовое содержимое",
  "embedding": [0.1, 0.2, 0.3, ...],
  "data_type": "shared_rule",
  "user_id": 123,
  "assistant_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

#### Поиск данных

```
POST /api/data/search
```

Ищет данные в векторной базе данных по эмбеддингу запроса.

**Тело запроса:**
```json
{
  "query_embedding": [0.1, 0.2, 0.3, ...],
  "data_type": "shared_rule",
  "user_id": 123,
  "assistant_id": "550e8400-e29b-41d4-a716-446655440000",
  "top_k": 5
}
```

#### Проверка работоспособности

```
GET /health
```

Проверяет работоспособность сервиса.

### Интеграция с Assistant Service

RAG сервис интегрируется с Assistant Service через инструмент `RAGTool`, который позволяет ассистентам использовать функциональность RAG для генерации ответов с учетом контекста из векторной базы данных.

## Тестирование

### Локальное тестирование

```bash
poetry run pytest
```

### Тестирование с использованием Docker

```bash
docker compose -f docker-compose.test.yml up --build
```

## Лицензия

MIT 